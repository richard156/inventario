<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario - Visualizaci√≥n Simple</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #4CAF50; color: white; }
        img.thumbnail { max-width: 80px; max-height: 80px; }
        .loading { color: #666; font-style: italic; }
        .error { color: red; background: #ffe6e6; padding: 15px; border-radius: 5px; }
        .success { color: green; background: #e8f5e9; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üì¶ Visualizaci√≥n de Inventario</h1>
    <p>Datos obtenidos de Google Sheets.</p>
    
    <div id="status" class="loading">‚è≥ Preparando para cargar datos...</div>
    <div id="data-container"></div>

    <script>
        // üîß CONFIGURACI√ìN - DEBES COMPLETAR ESTO
        const API_KEY = ''; // DEJAR VAC√çO POR AHORA - leer instrucciones abajo
        const SPREADSHEET_ID = '14Biamc2q1cvNegVz4pj0yfspWOoA1rf4';
        const RANGE = 'Data!A2:M'; // Ajusta si el nombre de la hoja es diferente
        
        // URL base para im√°genes (ajusta seg√∫n tu estructura en GitHub)
        const IMAGE_BASE_URL = 'scanpet/PHOTOS_salida_20260123_1452/';
        
        async function loadData() {
            const statusEl = document.getElementById('status');
            const containerEl = document.getElementById('data-container');
            
            try {
                // Verificar si hay API_KEY
                if (!API_KEY || API_KEY.length < 10) {
                    throw new Error('API_KEY no configurada. Sigue los pasos abajo.');
                }
                
                statusEl.textContent = '‚è≥ Cargando datos de Google Sheets...';
                statusEl.className = 'loading';
                
                // Construir URL de la API de Google Sheets
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}?key=${API_KEY}`;
                
                console.log('URL solicitada:', url);
                
                // Hacer la petici√≥n
                const response = await fetch(url);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Error ${response.status}: ${errorData.error?.message || 'Error desconocido'}`);
                }
                
                const data = await response.json();
                const rows = data.values || [];
                
                if (rows.length === 0) {
                    containerEl.innerHTML = '<p class="loading">No se encontraron datos en la hoja.</p>';
                    statusEl.textContent = '‚úÖ Hoja encontrada, pero sin datos.';
                    statusEl.className = 'success';
                    return;
                }
                
                // Mostrar los datos en una tabla
                let html = `
                    <div class="success">
                        ‚úÖ <strong>${rows.length} items cargados</strong> - ${new Date().toLocaleTimeString()}
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Art√≠culo</th>
                                <th>Unidades</th>
                                <th>Ubicaci√≥n</th>
                                <th>Precio</th>
                                <th>Fr√°gil</th>
                                <th>Foto</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                rows.forEach(row => {
                    const imageName = row[7]; // Columna H (√≠ndice 7) es Foto
                    const imageUrl = imageName ? `${IMAGE_BASE_URL}${imageName}` : '';
                    const isFragile = row[6]?.toUpperCase() === 'SI' ? 'style="background-color:#fff3cd"' : '';
                    
                    html += `
                        <tr ${isFragile}>
                            <td>${row[0] || ''}</td>
                            <td><strong>${row[1] || ''}</strong></td>
                            <td>${row[2] || '1'}</td>
                            <td>${row[4] || ''}</td>
                            <td>${formatPrice(row[5])}</td>
                            <td>${row[6] || 'No'}</td>
                            <td>${imageUrl ? `<img src="${imageUrl}" class="thumbnail" alt="Foto" onerror="this.style.display='none'">` : '‚Äî'}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                containerEl.innerHTML = html;
                
                statusEl.textContent = `‚úÖ ${rows.length} items cargados correctamente`;
                statusEl.className = 'success';
                
            } catch (error) {
                console.error('Error completo:', error);
                statusEl.className = 'error';
                
                if (error.message.includes('API_KEY')) {
                    statusEl.innerHTML = `
                        ‚ùå <strong>API_KEY no configurada</strong><br><br>
                        <strong>Sigue estos pasos:</strong><br>
                        1. Ve a <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a><br>
                        2. Crea un proyecto nuevo o selecciona uno existente<br>
                        3. Ve a "APIs & Services" > "Credentials"<br>
                        4. Haz clic en "Create Credentials" > "API Key"<br>
                        5. <strong>Copia la clave completa</strong> (40 caracteres)<br>
                        6. Vuelve a este c√≥digo y p√©gala en: const API_KEY = 'TU_CLAVE_AQUI';<br><br>
                        <small>Luego, actualiza esta p√°gina.</small>
                    `;
                } else if (error.message.includes('Error 403')) {
                    statusEl.innerHTML = `
                        ‚ùå <strong>Acceso denegado (403)</strong><br><br>
                        Posibles causas:<br>
                        1. La hoja de c√°lculo NO est√° compartida como "Cualquier persona con el enlace"<br>
                        2. La API_KEY no est√° restringida correctamente<br>
                        3. La API_KEY no tiene habilitada Google Sheets API<br><br>
                        <strong>Soluci√≥n:</strong><br>
                        1. Abre tu Google Sheet > Haz clic en "Compartir" > Cambia a "Cualquier persona con el enlace"<br>
                        2. En Google Cloud Console, para tu API_KEY:<br>
                           - Restricciones de API: "Google Sheets API"<br>
                           - Restricciones HTTP: https://richard156.github.io
                    `;
                } else if (error.message.includes('Error 404')) {
                    statusEl.innerHTML = `
                        ‚ùå <strong>Hoja no encontrada (404)</strong><br><br>
                        Verifica que:<br>
                        1. El SPREADSHEET_ID es correcto<br>
                        2. La hoja se llama exactamente "Data" (ver may√∫sculas)<br>
                        3. El rango es correcto: Data!A2:M
                    `;
                } else {
                    statusEl.textContent = `‚ùå Error: ${error.message}`;
                }
                
                containerEl.innerHTML = '';
            }
        }
        
        function formatPrice(value) {
            if (!value) return '‚Äî';
            const num = parseFloat(value);
            return isNaN(num) ? value : `$${num.toLocaleString('es-ES')}`;
        }
        
        // Cargar datos cuando la p√°gina se cargue
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
    
    <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #4CAF50;">
        <h3>üìã Pasos para Configurar:</h3>
        <ol>
            <li><strong>Obt√©n una API_KEY nueva</strong> en <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></li>
            <li><strong>Configura restricciones</strong> para tu API_KEY:
                <ul>
                    <li>Restricciones de API: "Google Sheets API"</li>
                    <li>Restricciones HTTP: https://richard156.github.io</li>
                </ul>
            </li>
            <li><strong>Comparte tu Google Sheet</strong> como "Cualquier persona con el enlace" (solo lectura)</li>
            <li><strong>Pega tu API_KEY</strong> en el c√≥digo arriba donde dice: <code>const API_KEY = '';</code></li>
            <li><strong>Actualiza esta p√°gina</strong></li>
        </ol>
    </div>
</body>
</html>
